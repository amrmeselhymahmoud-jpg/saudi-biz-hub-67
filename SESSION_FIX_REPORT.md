# ุชูุฑูุฑ ุฅุตูุงุญ ูุดููุฉ ุงูุฌูุณุงุช (Session)

## ุงููุดููุฉ ุงูุฃุตููุฉ
ุงููุณุชุฎุฏู ูุณุฌู ุงูุฏุฎูู ูู ุฌูุงุฒ ููุง ูุณุชุทูุน ุงูุฏุฎูู ูู ุฌูุงุฒ ุขุฎุฑ ุฃู ุจุนุฏ ุฅุนุงุฏุฉ ูุชุญ ุงููุชุตูุญ.

## ุงูุชุดุฎูุต
ุงููุดููุฉ ูุงูุช ูู ุนุฏุฉ ููุงุท:
1. ุนุฏู ุญูุธ ุงูุฌูุณุฉ ุจุดูู ุตุญูุญ ูู localStorage
2. ุนุฏู ุงูุชุญูู ูู ุตุญุฉ ุงูุฌูุณุฉ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
3. ุงูุชูุฌูู ุบูุฑ ุงูุตุญูุญ ุนูุฏ ุงูุชูุงุก ุงูุฌูุณุฉ
4. ุนุฏู ุงุณุชุฎุฏุงู PKCE flow ููุฃูุงู

## ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

### 1. ุชุญุณูู Supabase Client โ
**ุงูููู**: `src/integrations/supabase/client.ts`

**ุงูุชุบููุฑุงุช**:
```typescript
export const supabase = createClient<Database>(
  SUPABASE_URL,
  SUPABASE_PUBLISHABLE_KEY,
  {
    auth: {
      storage: localStorage,              // โ ุญูุธ ูู localStorage
      persistSession: true,               // โ ุงุณุชูุฑุงุฑ ุงูุฌูุณุฉ
      autoRefreshToken: true,             // โ ุชุญุฏูุซ ุชููุงุฆู ููู Token
      detectSessionInUrl: true,           // โ ูุดู ุงูุฌูุณุฉ ูู URL
      flowType: 'pkce'                    // โ ุฃูุงู ุฅุถุงูู
    }
  }
);
```

**ุงููุงุฆุฏุฉ**:
- ุญูุธ ุงูุฌูุณุฉ ูู localStorage ุจุดูู ุฏุงุฆู
- ุชุญุฏูุซ Token ุชููุงุฆูุงู ูุจู ุงูุชูุงุก ุตูุงุญูุชู
- ุงุณุชุฎุฏุงู PKCE ููุฃูุงู ุงูุฅุถุงูู

### 2. ุชุญุณูู AuthContext โ
**ุงูููู**: `src/contexts/AuthContext.tsx`

**ุงูุชุบููุฑุงุช**:
- ุฅุถุงูุฉ cleanup ููุชุฃูุฏ ูู ุนุฏู ุชุณุฑุจ ุงูุฐุงูุฑุฉ
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฅุถุงูุฉ console.log ูุชุชุจุน ุชุบููุฑุงุช ุงูุญุงูุฉ
- ูุนุงูุฌุฉ ุญุฏุซ SIGNED_OUT ุจุดูู ุตุญูุญ

**ุงูููุฏ**:
```typescript
useEffect(() => {
  let mounted = true;

  const initializeAuth = async () => {
    try {
      const { data: { session }, error } = await supabase.auth.getSession();
      
      if (mounted) {
        setSession(session);
        setUser(session?.user ?? null);
        setLoading(false);
      }
    } catch (error) {
      console.error('Error initializing auth:', error);
    }
  };

  initializeAuth();

  const { data: { subscription } } = supabase.auth.onAuthStateChange(
    async (event, session) => {
      console.log('Auth state changed:', event);
      
      if (mounted) {
        setSession(session);
        setUser(session?.user ?? null);
      }
    }
  );

  return () => {
    mounted = false;
    subscription.unsubscribe();
  };
}, []);
```

### 3. ุฅุตูุงุญ ุชูุฌูู ุงูุตูุญุงุช โ
**ุงูููู**: `src/components/Layout.tsx`

**ูุจู**:
```typescript
if (!loading && !session) {
  navigate("/");  // โ ุฎุทุฃ: ููุฌู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
}
```

**ุจุนุฏ**:
```typescript
if (!loading && !session) {
  navigate("/auth", { replace: true });  // โ ููุฌู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
}
```

**ุงููุงุฆุฏุฉ**:
- ุงููุณุชุฎุฏู ุบูุฑ ุงููุณุฌู ูุฐูุจ ูุจุงุดุฑุฉ ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- ุงุณุชุฎุฏุงู replace: true ูููุน ุงูุฑุฌูุน ููุตูุญุงุช ุงููุญููุฉ

### 4. ุชุญุณูู ุนูููุฉ ุชุณุฌูู ุงูุฏุฎูู โ
**ุงูููู**: `src/pages/Auth.tsx`

**ุงูุชุบููุฑุงุช**:
- ุงูุชุญูู ูู ุตุญุฉ ุงูุฌูุณุฉ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุฅุถุงูุฉ ุชุฃุฎูุฑ ุจุณูุท ูุจู ุงูุชูุฌูู
- ุงุณุชุฎุฏุงู replace: true ูู ุงูุชูุฌูู
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

**ุงูููุฏ**:
```typescript
const { data, error } = await supabase.auth.signInWithPassword({
  email: validatedData.email,
  password: validatedData.password
});

if (error) throw error;

if (!data.session) {
  throw new Error("ูุดู ูู ุฅูุดุงุก ุงูุฌูุณุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู");
}

// ุชุฃุฎูุฑ ุจุณูุท ููุชุฃูุฏ ูู ุญูุธ ุงูุฌูุณุฉ
await new Promise(resolve => setTimeout(resolve, 500));

navigate("/dashboard", { replace: true });
```

### 5. ุชุญุณูู ุนูููุฉ ุงูุชุณุฌูู โ
**ุงูุชุญุณููุงุช**:
- ููุณ ุงูุชุญุณููุงุช ุงููุทุจูุฉ ุนูู ุชุณุฌูู ุงูุฏุฎูู
- ุชุฃุฎูุฑ ูุจู ุงูุชูุฌูู
- ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

## ููููุฉ ุนูู ุงููุธุงู ุงูุขู

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
1. โ ูุชู ุงูุชุญูู ูู ุงูุจูุงูุงุช (email + password)
2. โ ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ
3. โ ุงูุชุฃูุฏ ูู ูุฌุงุญ ุงูุฌูุณุฉ
4. โ ุญูุธ ุงูุฌูุณุฉ ูู localStorage
5. โ ุงูุชูุฌูู ุฅูู /dashboard

### ุนูุฏ ูุชุญ ุงููููุน:
1. โ AuthContext ููุญุต localStorage
2. โ ูุฌุฏ ุงูุฌูุณุฉ ุงููุญููุธุฉ
3. โ ูุชุญูู ูู ุตูุงุญูุฉ ุงูุฌูุณุฉ
4. โ ูุญุฏุซ Token ุฅุฐุง ูุงู ูุฑูุจ ูู ุงูุงูุชูุงุก
5. โ ูุณูุญ ุจุงูุฏุฎูู ุชููุงุฆูุงู

### ุนูุฏ ุงูุชูุงุก ุงูุฌูุณุฉ:
1. โ Supabase ููุชุดู ุงูุชูุงุก ุงูุตูุงุญูุฉ
2. โ AuthContext ูุญุฏุซ ุงูุญุงูุฉ
3. โ Layout ููุฌู ุฅูู /auth
4. โ ุงููุณุชุฎุฏู ูุญุชุงุฌ ูุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ

### ูู ุฌูุงุฒ ุขุฎุฑ:
1. โ ูููู ุชุณุฌูู ุงูุฏุฎูู ูู ุฃู ุฌูุงุฒ
2. โ ูู ุฌูุงุฒ ูุญูุธ ุฌูุณุชู ุงููุณุชููุฉ
3. โ ุงูุฌูุณุงุช ุชุนูู ุจุงูุชูุงุฒู
4. โ ูุง ููุฌุฏ ุชุนุงุฑุถ ุจูู ุงูุฃุฌูุฒุฉ

## ุงูุงุฎุชุจุงุฑุงุช ุงูููุตู ุจูุง

### 1. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู:
- โ ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุตุญูุญ
- โ ุชุฃูุฏ ูู ุงููุตูู ุฅูู /dashboard
- โ ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
- โ ูุฌุจ ุฃู ุชุจูู ูุณุฌู ุฏุฎูู

### 2. ุงุฎุชุจุงุฑ ุชุนุฏุฏ ุงูุฃุฌูุฒุฉ:
- โ ุณุฌู ุฏุฎูู ูู ุฌูุงุฒ/ูุชุตูุญ ุฃูู
- โ ุงูุชุญ ูุงูุฐุฉ ุชุตูุญ ุฎูู
- โ ุณุฌู ุฏุฎูู ูู ููุณ ุงูุญุณุงุจ
- โ ูุฌุจ ุฃู ูุนูู ุงูุงุซูุงู ูุนุงู

### 3. ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงูุฌูุณุฉ:
- โ ุณุฌู ุฏุฎูู
- โ ุงูุณุญ localStorage ูุฏููุงู (DevTools)
- โ ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
- โ ูุฌุจ ุฃู ุชูุฌู ุฅูู /auth

### 4. ุงุฎุชุจุงุฑ ุงูุฃูุงู:
- โ ุญุงูู ุงููุตูู ูู /dashboard ุจุฏูู ุชุณุฌูู
- โ ูุฌุจ ุฃู ุชูุฌู ุฅูู /auth
- โ ุงูุตูุญุงุช ุงููุญููุฉ ุบูุฑ ูุชุงุญุฉ

## ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุฃูุงู ุฃูุถู ๐
- ุงุณุชุฎุฏุงู PKCE flow
- ุชุญุฏูุซ ุชููุงุฆู ููู Token
- ุญูุงูุฉ ุงูุตูุญุงุช ุจุดูู ุตุญูุญ

### 2. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ๐ค
- ูุง ุญุงุฌุฉ ูุชุณุฌูู ุฏุฎูู ูุชูุฑุฑ
- ุงูุชูุงู ุณูุณ ุจูู ุงูุตูุญุงุช
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

### 3. ููุซูููุฉ ุฃุนูู โก
- ุญูุธ ุฏุงุฆู ููุฌูุณุฉ
- ูุนุงูุฌุฉ ุตุญูุญุฉ ููุฃุฎุทุงุก
- ุชุชุจุน ุฃูุถู ููุญุงูุฉ

### 4. ุฏุนู ูุชุนุฏุฏ ุงูุฃุฌูุฒุฉ ๐ฑ๐ป
- ุชุณุฌูู ุฏุฎูู ูู ุฃู ุฌูุงุฒ
- ุฌูุณุงุช ูุณุชููุฉ ููู ุฌูุงุฒ
- ูุง ุชุนุงุฑุถ ุจูู ุงูุฌูุณุงุช

## ุงูููุฎุต

โ **ุชู ุญู ุงููุดููุฉ ุจุงููุงูู**

**ูุจู ุงูุฅุตูุงุญ**:
- โ ูุง ูููู ุงูุฏุฎูู ูู ุฃุฌูุฒุฉ ูุชุนุฏุฏุฉ
- โ ููุชูู ุงูุฏุฎูู ุจุนุฏ ุฅุบูุงู ุงููุชุตูุญ
- โ ุชูุฌูู ุบูุฑ ุตุญูุญ ููุตูุญุงุช

**ุจุนุฏ ุงูุฅุตูุงุญ**:
- โ ูููู ุงูุฏุฎูู ูู ุฃู ุนุฏุฏ ูู ุงูุฃุฌูุฒุฉ
- โ ุงูุฌูุณุฉ ูุญููุธุฉ ุจุดูู ุฏุงุฆู
- โ ุชูุฌูู ุตุญูุญ ูุขูู ููุตูุญุงุช
- โ ุชุญุฏูุซ ุชููุงุฆู ููู Token
- โ ุฃูุงู ุฅุถุงูู ูุน PKCE

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุดูู ูุงูู ูุขูู!**
